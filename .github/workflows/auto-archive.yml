name: ðŸ”’ Auto Archive Repository After Deadline

on:
  schedule:
    - cron: "0 * * * *"       # â° ÙŠØªØ­Ù‚Ù‚ ÙƒÙ„ Ø³Ø§Ø¹Ø©
  workflow_dispatch:           # ðŸ–ï¸ Ù„ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù…Ù† Actions tab

jobs:
  archive-repo:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ•’ Check current date
        id: get_date
        run: echo "date=$(date -u +'%Y-%m-%dT%H:%M:%SZ')" >> $GITHUB_OUTPUT

      - name: ðŸ” Compare with deadline
        id: check_deadline
        run: |
          # âœ… Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø§Ù„Ø£ÙˆÙ‚ÙŠØª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ UTC
          # 8:00 PM Ø¨ØªÙˆÙ‚ÙŠØª Ù…ØµØ± = 6:00 PM Ø¨ØªÙˆÙ‚ÙŠØª UTC
          DEADLINE="$(date -u -d '2025-11-08 18:00:00' +'%Y-%m-%dT%H:%M:%SZ')"
          NOW=$(date -u +'%Y-%m-%dT%H:%M:%SZ')

          echo "ðŸ•“ Current UTC time: $NOW"
          echo "ðŸ•› Deadline UTC time: $DEADLINE"

          if [[ "$NOW" > "$DEADLINE" ]]; then
            echo "expired=true" >> $GITHUB_OUTPUT
          else
            echo "expired=false" >> $GITHUB_OUTPUT
          fi

      - name: ðŸ”’ Lock all Issues and PRs
        if: steps.check_deadline.outputs.expired == 'true'
        uses: dessant/repo-lockdown@v3
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          lock-new-issues: true
          lock-new-pull-requests: true
          comment: "ðŸš« This repository is locked automatically after the deadline."

      - name: ðŸ“¦ Archive repository
        if: steps.check_deadline.outputs.expired == 'true'
        env:
          GH_TOKEN: ${{ secrets.ADMIN_TOKEN }}
        run: |
          echo "ðŸ“¦ Archiving repository..."
          gh api -X PATCH repos/${{ github.repository }} -f archived=true
          echo "âœ… Repository archived successfully!"
